(()=>{"use strict";let e=function(e){return e.DrawTable="draw-table",e.Notify="Notify",e.LoadVariables="load-variables",e.LoadVariablesResponse="load-variables-response",e.SendVariablesToServer="send-variables-to-server",e.SendVariablesToServerResponse="send-variables-to-server-response",e}({});const a=async e=>{const a=figma.createFrame();a.layoutMode="HORIZONTAL",a.layoutWrap="NO_WRAP",a.layoutSizingHorizontal="HUG",a.layoutSizingVertical="HUG",a.minWidth=260,a.name="cell",a.paddingRight=e.withMark?120:0;const i=figma.createFrame();i.layoutMode="HORIZONTAL",i.layoutWrap="NO_WRAP",i.layoutSizingHorizontal="HUG",i.layoutSizingVertical="HUG",i.horizontalPadding=16,i.verticalPadding=14,i.name="content";const t=figma.createText();return await figma.loadFontAsync(t.fontName),e.charactersVariable?t.setBoundVariable("characters",e.charactersVariable):t.characters=e.characters,t.fontSize=14,t.textAutoResize="WIDTH_AND_HEIGHT",t.name="text",i.appendChild(t),a.appendChild(i),{cell:a,content:i}},i=async e=>{const a=figma.createFrame();a.layoutMode="HORIZONTAL",a.layoutWrap="NO_WRAP",a.layoutSizingHorizontal="HUG",a.layoutSizingVertical="HUG",a.minWidth=200,a.name="header";const i=figma.createFrame();i.layoutMode="HORIZONTAL",i.layoutWrap="NO_WRAP",i.layoutSizingHorizontal="HUG",i.layoutSizingVertical="HUG",i.horizontalPadding=16,i.verticalPadding=16,i.name="content";const t=figma.createText();return await figma.loadFontAsync(t.fontName),t.characters=e,t.fontSize=14,t.textAutoResize="WIDTH_AND_HEIGHT",t.name="text",i.appendChild(t),a.appendChild(i),a},t=e=>{const a=figma.createFrame();return a.layoutMode="VERTICAL",a.layoutWrap="NO_WRAP",a.layoutSizingHorizontal="HUG",a.layoutSizingVertical="HUG",e.collection&&e.mode&&a.setExplicitVariableModeForCollection(e.collection,e.mode),a},o=e=>{figma.ui.postMessage(e)},n={[e.DrawTable]:async e=>{var o;let{data:n}=e;if(null===n||null===n.selectedCollection)return void figma.notify("Проверьте актуальность данных");const l=figma.variables.getLocalVariableCollections();if(!l.map((e=>e.id)).includes(n.selectedCollection))return void figma.notify("Проверьте актуальность данных");const r=l.find((e=>e.id===n.selectedCollection));if(!r)return void figma.notify("Проверьте актуальность данных");const d=null===(o=figma.variables.getVariableCollectionById(n.selectedCollection))||void 0===o?void 0:o.modes.filter((e=>n.selectedModes.includes(e.modeId)));if(d){const e=[];let o,l=!1;r.variableIds.forEach((a=>{const i=figma.variables.getVariableById(a);if(i&&!n.hiddenVariables.includes(i.id)){var t;const a={};i.valuesByMode&&d.forEach((e=>{var t;a[e.name]={value:null===(t=i.valuesByMode[e.modeId])||void 0===t?void 0:t.toString(),id:i.id}})),n.markAs[i.id]&&(l=!0),e.push({name:i.name,description:i.description,values:a,mark:null!==(t=n.markAs[i.id])&&void 0!==t?t:null})}})),1===figma.currentPage.selection.length&&"SECTION"===figma.currentPage.selection[0].type?(o=figma.currentPage.selection[0],o.children.forEach((e=>e.remove()))):o=figma.createSection(),o.name="Tokens table";const s=(()=>{const e=figma.createFrame();return e.layoutMode="HORIZONTAL",e.layoutWrap="NO_WRAP",e.name="tokens table",e.layoutSizingHorizontal="HUG",e.layoutSizingVertical="HUG",e})();o.appendChild(s),figma.currentPage.appendChild(o);const c=[[{name:"Token names"},...d.map((e=>({id:e.modeId,name:e.name})))],...e.map((e=>[{name:e.name},...d.map((a=>({name:e.values[a.name].value,id:e.values[a.name].id})))]))],g=[];for(const e of c[0]){const a=t({collection:r.id,mode:e.id}),o=await i(e.name);a.appendChild(o),s.appendChild(a),g.push(a)}for(let e=1;e<c.length;e++)for(let i=0;i<c[0].length;i++){const{cell:t}=await a({characters:c[e][i].name,withMark:0===i&&l,charactersVariable:c[e][i].id});g[i].appendChild(t)}g.forEach(((a,i)=>{a.children.forEach((async(a,t)=>{var o;if((o=a).layoutSizingHorizontal="FILL",o.strokes=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.08,blendMode:"NORMAL",visible:!0,boundVariables:{}}],o.strokeBottomWeight=1,o.strokeLeftWeight=0,o.strokeRightWeight=0,o.strokeTopWeight=0,0!==i){const[e,i]=(()=>{const e=figma.createFrame();e.layoutMode="HORIZONTAL",e.layoutWrap="NO_WRAP",e.name="divider",e.layoutSizingVertical="HUG",e.verticalPadding=12;const a=figma.createLine();return a.rotation=-90,a.strokes=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.08,blendMode:"NORMAL",visible:!0,boundVariables:{}}],a.strokeWeight=1,a.strokeCap="ROUND",e.appendChild(a),[e,a]})();e.resize(1,a.height),a.appendChild(e),i.layoutSizingHorizontal="FIXED",i.layoutSizingVertical="FILL",e.layoutPositioning="ABSOLUTE",e.x=0}if(0===i&&0!==t&&null!==e[t-1].mark){const{newBadge:i}=await(async e=>{const a=figma.createFrame();a.layoutMode="HORIZONTAL",a.layoutWrap="NO_WRAP",a.layoutSizingHorizontal="HUG",a.layoutSizingVertical="HUG",a.horizontalPadding=6,a.cornerRadius=6,a.verticalPadding=4,a.name="new";const i=figma.createText();return await figma.loadFontAsync(i.fontName),i.characters=e,i.fontSize=12,i.textAutoResize="WIDTH_AND_HEIGHT",i.name="badge text",i.fills=[{blendMode:"NORMAL",boundVariables:{},color:{r:1,g:1,b:1},opacity:1,type:"SOLID",visible:!0}],a.appendChild(i),{newBadge:a}})(e[t-1].mark);a.appendChild(i),i.fills=[{blendMode:"NORMAL",boundVariables:{},color:{r:.5921568870544434,g:.27843138575553894,b:1},opacity:1,type:"SOLID",visible:!0}],i.layoutPositioning="ABSOLUTE",i.x=a.width-i.width-20,i.y=a.height/2-i.height/2}}))})),o.resizeWithoutConstraints(s.width+400,s.height+200),s.x=300,s.y=100,e.forEach((async(e,a)=>{if(e.description){var i,t,n;const{cell:l,text:r,wrapper:d,line:c,lineWrapper:m}=await(async e=>{const a=figma.createFrame();a.layoutMode="HORIZONTAL",a.layoutWrap="NO_WRAP",a.name="marker",a.layoutSizingVertical="HUG",a.layoutSizingHorizontal="HUG";const i=figma.createFrame();i.layoutMode="HORIZONTAL",i.layoutWrap="NO_WRAP",i.name="description",i.layoutSizingVertical="HUG",i.layoutSizingHorizontal="HUG",i.verticalPadding=0,i.horizontalPadding=6,i.cornerRadius=6,i.maxWidth=250,a.appendChild(i);const t=figma.createText();await figma.loadFontAsync(t.fontName),t.characters=e,t.fontSize=12,t.textAutoResize="WIDTH_AND_HEIGHT",t.name="text",i.appendChild(t),t.fills=[{blendMode:"NORMAL",boundVariables:{},color:{r:1,g:1,b:1},opacity:1,type:"SOLID",visible:!0}];const o=figma.createFrame();o.layoutMode="HORIZONTAL",o.layoutWrap="NO_WRAP",o.name="line wrapper",o.layoutSizingVertical="HUG",o.layoutSizingHorizontal="HUG",a.appendChild(o);const n=figma.createLine();return n.strokes=[{type:"SOLID",color:{r:.5921568870544434,g:.27843138575553894,b:1},opacity:1,blendMode:"NORMAL",visible:!0,boundVariables:{}}],n.strokeWeight=1,n.strokeCap="SQUARE",{text:t,cell:i,wrapper:a,line:n,lineWrapper:o}})(e.description);o.appendChild(d),m.appendChild(c),m.layoutSizingVertical="FILL",c.layoutSizingHorizontal="FILL",c.layoutSizingVertical="FILL",r.layoutSizingHorizontal="FILL",d.fills=[],m.fills=[],l.fills=[{blendMode:"NORMAL",boundVariables:{},color:{r:.5921568870544434,g:.27843138575553894,b:1},opacity:1,type:"SOLID",visible:!0}],d.x=s.x-d.width+14,d.y=(null===(i=g[0].children[0])||void 0===i?void 0:i.height)+100+a*(null===(t=g[0].children[1])||void 0===t?void 0:t.height)+((null===(n=g[0].children[1])||void 0===n?void 0:n.height)/2-d.height/2)}})),figma.currentPage.selection=[o]}},[e.LoadVariables]:()=>{const a=figma.variables.getLocalVariableCollections(),i=a.reduce(((e,a)=>{var i;return e[a.id]=null===(i=figma.variables.getVariableCollectionById(a.id))||void 0===i?void 0:i.modes.map((e=>({name:e.name,id:e.modeId}))),e}),{}),t=a.reduce(((e,a)=>(e[a.id]=a.variableIds.map((e=>{const a=figma.variables.getVariableById(e);return a?{name:null==a?void 0:a.name,id:e,values:a.valuesByMode}:null})).filter((e=>null!==e)),e)),{}),n={collections:a.map((e=>({name:e.name,id:e.id}))),modes:i,variables:t};o({event:e.LoadVariablesResponse,data:n})},[e.Notify]:e=>{let{data:{message:a,options:i}}=e;figma.notify(a,i)},[e.SendVariablesToServer]:a=>{let{data:{url:i,headers:t,body:n}}=a;const l=Object.assign({"Content-Type":"application/json",Accept:"application/json"},t);fetch(i,{method:"POST",headers:l,body:JSON.stringify(n)}).then((a=>{console.log(a.body),o({event:e.SendVariablesToServerResponse,data:{}}),figma.notify("Variables sended")})).catch((a=>{console.log(a),o({event:e.SendVariablesToServerResponse,data:{}}),figma.notify(a.message,{error:!0})}))}};figma.showUI(__html__,{themeColors:!0,width:500,height:700}),figma.ui.onmessage=e=>{const a=n[e.event];a&&a(e)}})();